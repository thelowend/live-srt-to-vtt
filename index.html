<!DOCTYPE html>
<html lang="es">
	<head>
		<title>Live SRT to VTT</title>
	</head>
	<body>
		<video id="video" controls>
		<source src="http://corrupt-system.de/assets/media/sintel/sintel-trailer.m4v" type="video/mp4">
			<!--track label="English" kind="captions" srclang="en" src="subs/test.vtt" default-->
			<track label="English 2" kind="captions" srclang="en" src="subs/test.srt" default>
		</video>
	</body>
	<script>
		var vid = document.getElementById('video');
		var subs = vid.getElementsByTagName('track');
	  	
	  	var SRTtoVTT = function (srt) {
	  		return 'WEBVTT\n\n' + srt.replace(/,([0-9]{3})/g, '.$1');
	  	}

		var convertSub = function (file, idx) {
			var xmlhttp = new XMLHttpRequest({mozSystem: true});
			var reader = new FileReader();

			xmlhttp.onreadystatechange = function() {
			  
			  if (xmlhttp.status == 200 && xmlhttp.readyState == 4) {    
			    
			    var newSubs = SRTtoVTT(xmlhttp.responseText);
			    var blob = new Blob([newSubs], {type : 'text/webvtt'});
			    var track = document.createElement('track'); 

			    subs[idx].remove();
				
				track.kind = 'captions';
				track.label = 'srt to vtt';
				track.srclang = 'en';
				
				track.addEventListener('load', function() {
			    	this.mode = 'showing';
			    	vid.textTracks[idx].mode = 'showing'; // thanks Firefox
				});

				vid.appendChild(track);
			    
			    reader.onload = function (event) {
					track.src = event.target.result;
				};

			    reader.readAsDataURL(blob);

			  }
			
			}
			
			xmlhttp.open('GET', file, true);
			xmlhttp.send();
		};


		//INIT
		for (var i = 0; i < subs.length; i++) {
			var src = subs[i].src,
				type = src.substring(src.lastIndexOf('.') + 1);

			if (type === 'srt') {
				convertSub(src, i);
			}
		}

	</script>
</html>